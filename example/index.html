<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
<script>
  var Logdown = (function() {
    'use strict'

    function Logdown(opts) {
      // enforces new
      if (!(this instanceof Logdown)) {
        return new Logdown(opts)
      }

      //
      opts = opts || {}
      this.markdown = opts.markdown || true
      this.prefix = opts.prefix || ''

      //
      Logdown._instances.push(this)

      return this
    }

    // Static
    // ------

    Logdown._instances = []

    Logdown.enable = function() {

    }

    Logdown.disable = function() {

    }

    // Public
    // ------

    Logdown.prototype.log = function(text) {
      var parsedMarkdown
      var parsedText
      var styles

      if (this.markdown) {
        parsedMarkdown = parseMarkdown(text)
        parsedText = parsedMarkdown.text
        styles = parsedMarkdown.styles
      }

      parsedText = parsedText || text
      styles = styles || []

      console.log.apply(console, [parsedText].concat(styles))
    }

    Logdown.prototype.info = function(args) {
      // method body
    }

    Logdown.prototype.error = function(args) {
      // method body
    }

    Logdown.prototype.warning = function(args) {
      // method body
    }

    // Private
    // -------

    function parseMarkdown(text) {
      var styles = []
      var match = getNextMatch(text)

      while (match) {
        text = text.replace(match.rule.regexp, match.rule.replacer)
        styles.push(match.rule.style)
        styles.push('')

        match = getNextMatch(text)
      }

      return {text: text, styles: styles}
    }

    function getNextMatch(text) {
      var matches = []
      var rules = [
        {
          regexp: /\*([^\*]+)\*/,
          replacer: function(match, submatch1) {
            return '%c' + submatch1 + '%c'
          },
          style: 'font-weight: bold;'
        },
        {
          regexp: /\_([^\_]+)\_/,
          replacer: function(match, submatch1) {
            return '%c' + submatch1 + '%c'
          },
          style: 'font-style: italic'
        },
        {
          regexp: /\`([^\`]+)\`/,
          replacer: function(match, submatch1) {
            return "%c" + submatch1 + "%c";
          },
          style: 'background: rgb(255, 255, 219); padding: 1px 5px; border: 1px solid rgba(0, 0, 0, 0.1)'
        }
      ]

      //
      rules.forEach(function(rule) {
        var match = text.match(rule.regexp)
        if (match) {
          matches.push({
            rule: rule,
            match: match
          })
        }
      })
      if (matches.length === 0) {
        return null;
      }

      //
      // matches.sort(function(a, b) {
      //   return a.match.index - b.match.index
      // })

      return matches[0]
    }

    return Logdown

  }())
</script>
<script>
  // var log1 = new Logdown({markdown: true)
  // var log2 = new Logdown({markdown: false, type: 'log')
  // var log2 = new Logdown({markdown: false, prefix: 'foo', type: 'info')
  // var log2 = new Logdown({
  //   markdown: false,
  //   prefix: 'foo',
  //   type: 'info',
  //   timestamp: true
  // })

  var log = new Logdown()
  log.log('lorem *ipsum* dolor sit _amet_ foo bar')
  log.log('lorem *ipsum* dolor sit _amet_ foo bar `var foo = 1` lorem')
  // log.markdown = false
  log.log('lorem *ipsum* dolor sit _amet_ foo bar `var foo = 1` lorem')

</script>
</body>
</html>
